<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Asha ‚Äî Voice Health Assistant</title>
<style>
body {
  font-family: Poppins, sans-serif;
  background: #f7f9fb;
  color: #111;
  text-align: center;
  padding: 32px;
}
h1 { color: #0b5cff; margin-bottom: 1rem; }
#card {
  background: #fff;
  border-radius: 12px;
  padding: 24px;
  max-width: 700px;
  margin: auto;
  box-shadow: 0 6px 20px rgba(0,0,0,0.1);
}
button {
  background: #0b5cff;
  color: white;
  border: none;
  padding: 10px 18px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  margin: 8px;
}
button:hover { background: #004fcc; }
#status { font-weight: 600; margin-top: 10px; }
#transcript {
  background: #f1f3f5;
  border-radius: 8px;
  padding: 12px;
  margin-top: 12px;
  text-align: left;
  font-size: 15px;
}
.hidden { display: none; }
</style>
</head>

<body>
<h1>ü©∫ Asha ‚Äî Your Health Assistant</h1>
<div id="card">
  <p>Talk to Asha about your symptoms. She‚Äôll understand and suggest the right doctor.</p>
  <button id="startBtn">üé§ Talk to Asha</button>
  <button id="stopBtn">‚èπ Stop</button>
  <button id="bandhuBtn" style="background:#19a974;">ü§ù Meet Bandhu</button>
  <div id="status">Status: idle</div>
  <div id="transcript"><em>Transcript will appear here...</em></div>
</div>

<script>
const SPECIALTIES = {
  "Cardiologist": ["heart", "chest pain", "bp", "blood pressure", "palpitation"],
  "Gastroenterologist": ["stomach", "acid", "vomit", "diarrhea", "indigestion"],
  "Dermatologist": ["skin", "itch", "rash", "acne"],
  "Neurologist": ["headache", "migraine", "dizzy", "seizure"],
  "ENT": ["ear", "nose", "throat", "sinus", "hearing"],
  "General Physician": ["fever", "cold", "cough", "pain", "body ache"]
};

const PACKAGES = {
  "Cardiologist": "‚ù§Ô∏è Heart Checkup Package",
  "Gastroenterologist": "üçΩÔ∏è Digestive Wellness Plan",
  "Dermatologist": "üíÜ Skin & Allergy Test",
  "Neurologist": "üß† Neuro Health Screening",
  "ENT": "üëÇ ENT Complete Check",
  "General Physician": "ü©∫ Full Body Health Package"
};

let recognition;
let data = { symptoms:"", specialist:"", date:"", time:"", area:"", package:"" };
const transcriptBox = document.getElementById("transcript");
const statusBox = document.getElementById("status");

// -------------- SPEAK FUNCTION --------------
function speak(text, next) {
  const u = new SpeechSynthesisUtterance(text);
  u.lang = "en-IN"; // Indian accent
  u.rate = 0.95;
  u.pitch = 1.1;

  // Pick soft Indian female voice if available
  const voices = speechSynthesis.getVoices();
  const indianVoice = voices.find(v => /female/i.test(v.name) && /en-IN/.test(v.lang));
  if (indianVoice) u.voice = indianVoice;

  u.onend = () => next && next();
  speechSynthesis.speak(u);
  statusBox.textContent = "Asha: " + text;
}

// -------------- LISTEN FUNCTION --------------
function listen(prompt, callback) {
  speak(prompt, () => {
    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!SR) {
      alert("Speech Recognition not supported in this browser.");
      return;
    }
    recognition = new SR();
    recognition.lang = "en-IN";
    recognition.interimResults = false;
    recognition.onresult = e => {
      const txt = e.results[0][0].transcript;
      transcriptBox.innerHTML += `<p><strong>You:</strong> ${txt}</p>`;
      callback(txt);
    };
    recognition.onerror = e => {
      speak("Sorry, I couldn‚Äôt hear you properly.", () => callback(""));
    };
    recognition.start();
  });
}

// -------------- FLOW CONTROL --------------
function getSpecialist(symptoms) {
  let best = "General Physician", max = 0;
  for (const s in SPECIALTIES) {
    let count = SPECIALTIES[s].filter(k => symptoms.toLowerCase().includes(k)).length;
    if (count > max) { best = s; max = count; }
  }
  return best;
}

const yes = t => /yes|yeah|sure|okay|ok/i.test(t);

// -------------- FLOW STEPS --------------
function startConversation() {
  transcriptBox.innerHTML = "";
  speak("Hi! I‚Äôm Asha, your health assistant. How are you feeling today?", () => askSymptoms());
}

function askSymptoms() {
  listen("Please tell me what symptoms you are experiencing.", t => {
    data.symptoms = t;
    data.specialist = getSpecialist(t);
    speak(`Got it. Based on what you said, you may need a ${data.specialist}.`, () => askBooking());
  });
}

function askBooking() {
  listen("Would you like me to book an appointment for you?", t => {
    if (yes(t)) {
      speak("Alright. Your details will be taken from your logged-in account.", () => askDate());
    } else {
      speak("Okay, take care! You can talk to me again anytime.");
    }
  });
}

function askDate() {
  listen("When would you like to visit the doctor?", t => {
    data.date = t;
    askTime();
  });
}

function askTime() {
  listen("What time works best for you? Morning or afternoon?", t => {
    data.time = t;
    askArea();
  });
}

function askArea() {
  listen("Which area is convenient for you?", t => {
    data.area = t;
    askPackage();
  });
}

function askPackage() {
  listen("Would you like to add a health package too?", t => {
    if (yes(t)) {
      data.package = PACKAGES[data.specialist];
      speak(`I suggest the ${data.package}.`, finish);
    } else {
      finish();
    }
  });
}

function finish() {
  speak("Thank you. Redirecting you to the available doctors now.", () => {
    const q = new URLSearchParams(data).toString();
    window.location.href = "doctors.html?" + q;
  });
}

// -------------- BUTTON EVENTS --------------
document.getElementById("startBtn").onclick = () => {
  speechSynthesis.cancel(); // reset any old speech
  startConversation();
};
document.getElementById("stopBtn").onclick = () => {
  if (recognition) recognition.stop();
  speechSynthesis.cancel();
  statusBox.textContent = "Stopped.";
};
document.getElementById("bandhuBtn").onclick = () => window.location.href = "bandhu.html";

// preload voices
speechSynthesis.onvoiceschanged = () => {};
</script>
</body>
</html>
