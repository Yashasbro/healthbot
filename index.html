<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Asha ‚Äî Voice Health Assistant</title>
<style>
  body{font-family:Poppins,sans-serif;background:#f6f8fb;color:#111;text-align:center;padding:28px}
  h1{color:#0b5cff;margin-bottom:1rem;}
  #card{background:#fff;border-radius:12px;max-width:760px;margin:0 auto;padding:20px;box-shadow:0 6px 24px rgba(9,30,66,0.08);text-align:left}
  button{background:#0b5cff;color:white;border:none;padding:10px 18px;border-radius:8px;cursor:pointer;font-weight:600;margin:8px}
  button:hover{background:#0056b3;}
  #status{font-weight:600;margin-top:10px}
  #transcript{background:#f8fafc;border-radius:8px;padding:12px;margin-top:12px;min-height:90px}
  .hint{font-size:13px;color:#666;margin-top:8px}
</style>
</head>
<body>
<h1>ü©∫ Asha ‚Äî Your Health Voice Assistant</h1>

<div id="card">
  <p>Speak naturally with Asha. She‚Äôll understand your symptoms, suggest doctors and packages, and help you book easily.</p>
  <button id="startBtn">üé§ Start</button>
  <button id="stopBtn">‚èπ Stop</button>
  <div id="status">Status: idle</div>
  <div id="transcript"><em>Transcript will appear here.</em></div>
  <div class="hint">Best experienced in Chrome. Allow microphone when prompted.</div>
</div>

<script>
const SPECIALTY_KEYWORDS = {
  "Cardiologist": ["heart","chest pain","palpitation","bp","blood pressure"],
  "Gastroenterologist": ["stomach","acidity","heartburn","ulcer","nausea","vomit","diarrhea"],
  "Dermatologist": ["skin","rash","itch","acne","eczema"],
  "Neurologist": ["headache","migraine","numbness","seizure"],
  "ENT": ["ear","nose","throat","sinus","hearing"],
  "General Physician": ["fever","cold","cough","weak","tired","body ache"]
};
const PACKAGE_KEYWORDS = {
  "Cardiologist": "‚ù§Ô∏è Cardiac Health Checkup",
  "Gastroenterologist": "üçΩÔ∏è Digestive Wellness Package",
  "Dermatologist": "üíÜ Skin Care & Allergy Test",
  "Neurologist": "üß† Neuro Health Evaluation",
  "ENT": "üëÇ ENT Complete Check",
  "General Physician": "ü©∫ Full Body Health Package"
};

let extracted = { specialist:null, name:null, phone:null, date:null, time:null, area:null, symptoms:null, wantAppointment:null, wantPackage:null, package:null };
let currentStep = 0;
let conversation = "";
let recognition = null, isListening=false;

const statusEl = document.getElementById('status');
const transcriptEl = document.getElementById('transcript');
function setStatus(s){ statusEl.textContent="Status: "+s; }
function appendTranscript(t){ conversation+=" "+t; transcriptEl.textContent=conversation.trim(); }

function speak(text, next){
  const u = new SpeechSynthesisUtterance(text);
  u.lang='en-IN'; u.rate=0.95; u.pitch=1.2; // softer female tone
  u.voice = speechSynthesis.getVoices().find(v=>/female/i.test(v.name) && /en-IN|en-GB/.test(v.lang)) || null;
  u.onend=()=>next&&next();
  speechSynthesis.cancel(); speechSynthesis.speak(u);
}

function createRecognizer(){
  const SR = window.SpeechRecognition||window.webkitSpeechRecognition;
  if(!SR){ alert('Speech recognition not supported. Use Chrome.'); return null; }
  const r=new SR();
  r.lang='en-IN'; r.interimResults=false; r.maxAlternatives=1; r.continuous=false;
  r.onresult=e=>{const t=e.results[0][0].transcript;appendTranscript(t);handleResponse(t);};
  r.onerror=e=>setStatus('error: '+e.error);
  r.onend=()=>isListening=false;
  return r;
}
function listenOnce(prompt, cb){
  speak(prompt,()=>{
    recognition=createRecognizer();
    if(!recognition)return;
    isListening=true;
    recognition.onresult=e=>{
      const t=e.results[0][0].transcript.trim();
      appendTranscript(t);
      isListening=false;
      cb(t);
    };
    recognition.start();
  });
}

function getSpecialist(t){t=t.toLowerCase();let s="General Physician",max=0;
for(const sp in SPECIALTY_KEYWORDS){let c=0;for(const k of SPECIALTY_KEYWORDS[sp])if(t.includes(k))c++;if(c>max){max=c;s=sp;}}
return s;}
function getPhone(t){const m=t.replace(/\D/g,'').match(/(\d{10})/);return m?m[1]:null;}
function getName(t){const m=t.match(/(?:my name is|i am|this is)\s+([A-Z]?[a-z]+(?:\s+[A-Z]?[a-z]+)?)/i);return m?m[1]:null;}
function getDate(t){if(/tomorrow/i.test(t))return"Tomorrow";const m=t.match(/(\d{1,2}\/\d{1,2}\/?\d{0,4})/);return m?m[1]:null;}
function getTime(t){const m=t.match(/(\d{1,2}(:\d{2})?\s*(am|pm))/i);return m?m[1]:null;}
function getArea(t){const a=["indiranagar","koramangala","whitefield","jayanagar","hsr"];t=t.toLowerCase();for(const x of a)if(t.includes(x))return x;return null;}
function yesNo(t){return /yes|yeah|sure|ok/i.test(t);}

function startBot(){
  conversation=""; transcriptEl.textContent=""; extracted={};
  speak("Hi! I‚Äôm Asha, your health assistant. How are you feeling today?",()=>askSymptoms());
}
function askSymptoms(){listenOnce("Please tell me your symptoms in short.",(t)=>{
  extracted.symptoms=t; extracted.specialist=getSpecialist(t);
  askAppointment();
});}
function askAppointment(){
  listenOnce("Would you like me to help book an appointment for you?",(t)=>{
    extracted.wantAppointment=yesNo(t);
    if(extracted.wantAppointment) askName(); else {
      speak("Alright! I hope you feel better soon. You can ask me anytime if you need to book an appointment.");
    }
  });
}
function askName(){listenOnce("May I have your full name please?",(t)=>
