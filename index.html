<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Asha ‚Äî Voice Health Assistant (Enhanced)</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
  body{font-family:'Poppins',sans-serif;background:#f4f7fb;margin:0;padding:2rem;color:#122}
  h1{color:#0b5cff;margin-bottom:0.5rem}
  .btns{display:flex;gap:10px;flex-wrap:wrap;margin:1rem 0}
  button{background:#0b5cff;color:#fff;border:none;padding:10px 16px;border-radius:8px;cursor:pointer;font-weight:600}
  button.alt{background:#eef6ff;color:#0b5cff;border:1px solid #d8e9ff}
  button.green{background:#19a974}
  #status{margin-top:8px;font-weight:600}
  #transcript{margin-top:12px;background:#fff;border-radius:10px;padding:14px;min-height:120px;color:#0d1b2a;box-shadow:0 4px 10px rgba(0,0,0,0.05)}
</style>
</head>
<body>
  <h1>ü©∫ Asha ‚Äî Your Caring Health Assistant</h1>
  <p>Speak naturally. Asha will guide you softly and show doctors or help book if you wish.</p>

  <div class="btns">
    <button id="startBtn">üé§ Talk to Asha</button>
    <button id="pauseBtn" class="alt">‚è∏ Pause / Repeat</button>
    <button id="stopBtn" class="alt">‚èπ Stop</button>
    <button id="bandhuBtn" class="green">ü§ù Bandhu (Care Helpers)</button>
  </div>

  <div id="status">Status: idle</div>
  <div id="transcript"><em>Transcript will appear here‚Ä¶</em></div>

<script>
/*---------------------------------------------
  SETTINGS & DATA
---------------------------------------------*/
const SPECIALTIES = {
  "Cardiologist":["heart","chest","palpitation","bp","blood pressure","chest pain"],
  "Gastroenterologist":["stomach","acid","heartburn","nausea","indigestion","vomit","gastric"],
  "Dermatologist":["skin","rash","itch","acne","eczema","pimple"],
  "Neurologist":["headache","migraine","numb","seizure","dizzy"],
  "ENT":["ear","nose","throat","sinus","hearing"],
  "General Physician":["fever","cold","cough","body ache","weak"]
};
const PACKAGES = {
  "Cardiologist":["Heart Basic","Cardio Advanced","Cardio Executive"],
  "Gastroenterologist":["Digestive Basic","Gut Plus","GI Advanced"],
  "Dermatologist":["Skin Basic","Allergy Panel","Derm Advanced"],
  "Neurologist":["Neuro Basic","Neurology Panel","Migraine Check"],
  "ENT":["ENT Basic","Sinus Panel","Hearing Check"],
  "General Physician":["Full Body Basic","Complete Health","Preventive Pack"]
};
const ACCOUNT = { name:"LoggedIn User", phone:"9999999999" };
const AREAS = ["indiranagar","koramangala","whitefield","jayanagar","hsr","btm","malleshwaram"];

/*---------------------------------------------
  SPEECH UTILITIES
---------------------------------------------*/
let lastQuestion = "";
let recognition, recognizing = false;
function append(t){ 
  const el=document.getElementById("transcript");
  if(el.innerHTML.includes("<em>")) el.innerHTML="";
  el.innerHTML += `<div>${t}</div>`;
  el.scrollTop = el.scrollHeight;
}
function containsYes(t){return /\b(yes|yeah|yep|sure|ok|okay|please)\b/i.test(t);}
function detectSpecialist(t){
  t=t.toLowerCase();let top="General Physician",best=0;
  for(const s in SPECIALTIES){
    let c=0;for(const kw of SPECIALTIES[s]) if(t.includes(kw)) c++;
    if(c>best){best=c;top=s;}
  }return top;
}
async function voicesReady(){return new Promise(r=>{if(speechSynthesis.getVoices().length)r();else speechSynthesis.onvoiceschanged=r;});}
async function speak(txt){
  await voicesReady();
  lastQuestion = txt;
  return new Promise(res=>{
    const u=new SpeechSynthesisUtterance(txt);
    u.lang="en-IN";u.rate=0.95;u.pitch=1.1;
    const v=speechSynthesis.getVoices().find(x=>/female/i.test(x.name)&&/en-IN|en-GB/.test(x.lang));
    if(v)u.voice=v;
    u.onend=()=>res();
    speechSynthesis.cancel();speechSynthesis.speak(u);
  });
}
function listenOnce(timeout=10000){
  return new Promise(res=>{
    const SR = window.Sp
