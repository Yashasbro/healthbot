<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Asha - Health Voice Bot</title>
  <style>
    body {font-family: 'Poppins', sans-serif;background:#f9f9fb;color:#333;text-align:center;padding:2rem;}
    h1 {color:#007bff;margin-bottom:1rem;}
    button {background:#007bff;color:white;border:none;padding:0.8rem 1.6rem;font-size:1rem;border-radius:8px;cursor:pointer;}
    button:hover{background:#0056b3;}
    #statusText{margin-top:1rem;font-weight:600;}
    #micAnimation.listening{width:50px;height:50px;border-radius:50%;background:#ff4747;margin:1rem auto;animation:pulse 1s infinite;}
    @keyframes pulse{0%{transform:scale(1);opacity:1;}50%{transform:scale(1.2);opacity:0.6;}100%{transform:scale(1);opacity:1;}}
    #transcriptBox{background:#fff;padding:1rem;border-radius:10px;margin:1rem auto;width:90%;max-width:500px;box-shadow:0 0 8px rgba(0,0,0,0.1);text-align:left;display:none;}
  </style>
</head>

<body>
  <h1>ü©∫ Talk to Asha</h1>
  <p>Hi! I‚Äôm Asha, your friendly health assistant. Click below to start talking!</p>

  <button id="startBtn">üé§ Talk to Asha</button>
  <button id="endCallBtn" class="hidden">‚èπ End Call</button>

  <div id="micAnimation" class="hidden"></div>
  <div id="statusText">Waiting to connect...</div>

  <div id="transcriptBox">
    <h3>Conversation Transcript:</h3>
    <div id="transcriptText"></div>
  </div>

  <!-- ‚úÖ Correct ElevenLabs CDN path -->
 <script src="https://elevenlabs.io/convai-widget/index.js"></script>



  <script>
  const ELEVENLABS_AGENT_ID = "agent_1901k8v4exkseqk9s4ts0a5ycks2";
  let conversationWidget = null;
  let conversationTranscript = "";

  // Wait until SDK ready
  function waitForElevenLabsSDK(){
    return new Promise((resolve,reject)=>{
      let tries=0;
      const iv=setInterval(()=>{
        tries++;
        if(window.elevenlabs && typeof window.elevenlabs.Conversation==="function"){clearInterval(iv);resolve();}
        if(tries>50){clearInterval(iv);reject("SDK not loaded");}
      },100);
    });
  }

  async function initElevenLabsConversation(){
    const status=document.getElementById("statusText");
    const mic=document.getElementById("micAnimation");
    const transcriptBox=document.getElementById("transcriptBox");
    const transcript=document.getElementById("transcriptText");
    const endBtn=document.getElementById("endCallBtn");

    status.textContent="Loading ElevenLabs SDK...";

    try{await waitForElevenLabsSDK();}
    catch(err){console.error(err);status.textContent="‚ùå ElevenLabs failed to load. Check script URL.";return;}

    status.textContent="Connecting to Asha...";

    try{
      conversationWidget=window.elevenlabs.Conversation({
        agentId:ELEVENLABS_AGENT_ID,
        onConnect:()=>{
          console.log("‚úÖ Connected to Asha");
          status.textContent="üé§ Listening... Speak now!";
          mic.classList.remove("hidden");
          mic.classList.add("listening");
          endBtn.classList.remove("hidden");
          transcriptBox.style.display="block";
        },
        onMessage:(msg)=>{
          const who=msg.source==="user"?"You":"Asha";
          const text=msg.message||msg.text||"";
          transcript.innerHTML+=`<p><strong>${who}:</strong> ${text}</p>`;
          conversationTranscript+=" "+text;
        },
        onDisconnect:()=>{
          console.log("‚ùå Asha disconnected");
          handleConversationEnd();
        }
      });
      await conversationWidget.startSession();
    }catch(err){
      console.error("Error connecting:",err);
      status.textContent="‚ùå Could not connect. Check Agent ID or domain allowlist.";
    }
  }

  function handleConversationEnd(){
    const status=document.getElementById("statusText");
    const mic=document.getElementById("micAnimation");
    const endBtn=document.getElementById("endCallBtn");
    status.textContent="Call ended.";
    mic.classList.remove("listening");
    endBtn.classList.add("hidden");
  }

  document.getElementById("startBtn").addEventListener("click",initElevenLabsConversation);
  document.getElementById("endCallBtn").addEventListener("click",()=>{if(conversationWidget)conversationWidget.stopSession();handleConversationEnd();});
  </script>
  <elevenlabs-convai agent-id="agent_1901k8v4exkseqk9s4ts0a5ycks2"></elevenlabs-convai>
<script src="https://elevenlabs.io/convai-widget/index.js"></script>

</body>





