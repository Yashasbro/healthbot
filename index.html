<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Asha ‚Äî Voice Health Assistant 4.1</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
body{font-family:'Poppins',sans-serif;background:#f4f7fb;margin:0;color:#122;}
.wrap{max-width:900px;margin:36px auto;padding:24px;background:#fff;border-radius:12px;box-shadow:0 8px 30px rgba(16,24,40,.06);}
h1{margin:0 0 12px;color:#0b5cff}
p.lead{color:#555;margin-bottom:20px}
button{background:#0b5cff;color:#fff;border:none;padding:10px 18px;border-radius:8px;cursor:pointer;font-weight:600;margin:4px;}
button.alt{background:#eef6ff;color:#0b5cff;border:1px solid #d8e9ff}
button.green{background:#19a974}
#status{margin-top:10px;font-weight:600;}
#transcript{margin-top:12px;background:#f6f9ff;border-radius:10px;padding:14px;min-height:100px;color:#0d1b2a;line-height:1.4}
.small{font-size:13px;color:#6b7280;margin-top:8px}
</style>
</head>
<body>
<div class="wrap">
  <h1>ü©∫ Asha ‚Äî Your Caring Health Assistant</h1>
  <p class="lead">Talk naturally ‚Äî Asha will softly ask up to 4 questions, suggest doctors and health packages, and book using your saved account info if you wish.</p>
  <button id="startBtn">üé§ Talk to Asha</button>
  <button id="stopBtn" class="alt">‚èπ Stop</button>
  <button id="bandhuBtn" class="green">ü§ù Bandhu (Care Helpers)</button>
  <div id="status">Status: Idle</div>
  <div id="transcript"><em>Transcript appears here...</em></div>
</div>

<script>
const SPECIALTIES = {
  "Cardiologist": ["heart","chest","bp","pressure","palpitation"],
  "Gastroenterologist": ["stomach","acid","vomit","indigestion","heartburn"],
  "Dermatologist": ["skin","itch","rash","acne"],
  "Neurologist": ["headache","migraine","dizzy","numb","memory"],
  "ENT": ["ear","nose","throat","sinus","hearing"],
  "General Physician": ["fever","cold","cough","body ache","weak"]
};
const PACKAGES = {
  "Cardiologist": ["Heart Care Basic","Cardio Plus","Cardio Max","Heart Wellness Plan"],
  "Gastroenterologist": ["Digestive Health","Gut Detox","Liver Check","Stomach Scan"],
  "Dermatologist": ["Skin Glow","Allergy Test","Full Skin Check","Acne Care"],
  "Neurologist": ["Neuro Scan","Brain Wellness","Migraine Package","Sleep Study"],
  "ENT": ["ENT Basic","Sinus Check","Hearing Test","Throat Care"],
  "General Physician": ["Full Body Checkup","Essential Health","Complete Wellness","Preventive Care"]
};

const ACCOUNT = {name:"LoggedIn User", phone:"9999999999"};
let recog=null;
const transcriptEl=document.getElementById('transcript');
const statusEl=document.getElementById('status');

async function speak(txt){
 return new Promise(r=>{
   const u=new SpeechSynthesisUtterance(txt);
   u.lang="en-IN";u.pitch=1.1;u.rate=0.95;
   const v=speechSynthesis.getVoices().find(v=>/female/i.test(v.name)&&/en-IN|en-GB/.test(v.lang));
   if(v)u.voice=v;
   u.onend=r;speechSynthesis.cancel();speechSynthesis.speak(u);
   statusEl.textContent="Asha: "+txt;
 });
}
function listenOnce(ms=7000){
 return new Promise(res=>{
  const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
  if(!SR){res("");return;}
  try{
   const r=new SR();recog=r;r.lang="en-IN";r.onresult=e=>{
     const t=e.results[0][0].transcript;append("You: "+t);res(t);
   };
   r.onerror=()=>res("");r.start();
   setTimeout(()=>{try{r.stop();}catch{}res("");},ms);
  }catch{res("");}
 });
}
function append(t){if(transcriptEl.innerHTML.includes("<em>"))transcriptEl.innerHTML="";transcriptEl.innerHTML+=`<div>${t}</div>`;}
function yes(t){return /yes|yeah|sure|ok|okay/i.test(t);}
function detectSpec(t){t=t.toLowerCase();let best="General Physician",max=0;for(const s in SPECIALTIES){let c=0;for(const k of SPECIALTIES[s])if(t.includes(k))c++;if(c>max){best=s;max=c;}}return best;}

async function startFlow(){
 let data={symptoms:"",specialist:"",datetime:"",area:"",packages:[],book:false,name:ACCOUNT.name,phone:ACCOUNT.phone};
 transcriptEl.innerHTML="";

 await speak("Hi there, I‚Äôm Asha. Please tell me what symptoms you‚Äôre having.");
 const s=await listenOnce();data.symptoms=s;data.specialist=detectSpec(s);
 await speak(`It seems you may need a ${data.specialist}. Would you like me to help you book an appointment?`);
 const b=await listenOnce();if(yes(b)){data.book=true;await speak("Sure, your account information will be considered for booking.");}else{data.book=false;}

 await speak("When and where would you like the appointment, for example, tomorrow morning in Koramangala?");
 const d=await listenOnce();data.datetime=d;data.area=d;

 await speak("Would you like me to include a health package for better care?");
 const h=await listenOnce();
 if(yes(h)){
   data.packages=PACKAGES[data.specialist]||PACKAGES["General Physician"];
   await speak(`Alright. I found ${data.packages.length} suitable packages like ${data.packages[0]} and ${data.packages[1]}. They will appear in your booking page.`);
 }else{
   data.packages=[];
   await speak("Okay, no additional packages will be added.");
 }

 await speak("Let me show you the best doctors for you now.");
 const q=new URLSearchParams(data).toString();
 window.location.href="doctors.html?"+q;
}

document.getElementById('startBtn').onclick=()=>{speechSynthesis.cancel();startFlow();};
document.getElementById('stopBtn').onclick=()=>{try{recog.stop();}catch{}speechSynthesis.cancel();statusEl.textContent="Stopped."};
document.getElementById('bandhuBtn').onclick=()=>window.location.href='bandhu.html';
speechSynthesis.onvoiceschanged=()=>{};
</script>
</body>
</html>
